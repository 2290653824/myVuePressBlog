## 背景

基础设施即服务 

平台即服务

软件设施即服务





问题：

在最老的未服务架构中，我们一台机器部署一个应用，每个机器之间通过地址端口就可以进行通信。

但是当我们使用容器技术时，每个容器中的端口需要映射到机器的实际端口，这种端口映射在服务很多后就很难管理，这时候我们就需要一种很好的管理工具。



解决方案：

1. 资源管理器 MESOS

2019 推特由MESOS转向k8s



2. docker SWARM

缺点：不能进行回滚等功能

2019 阿里云不再使用



3. kubernetes 

google、go语言编写

特点：

轻量级：消耗的资源少



## 介绍说明

### 前生今世



### 组件框架

#### borg

了解组件的前提，先了解borg的架构

![image-20230116235941881](https://2290653824-github-io.oss-cn-hangzhou.aliyuncs.com/undefinedimage-20230116235941881.png)

- borgmaster

首先borgMaster主要用作流量的分发，可以处理当一个请求过来了，相应的流量可以打到哪个borglet地方。

- borglet

每一个具体的服务对应的节点，可能对应着一个服务

- 访问方式

borgmaster有3种访问方式

1. 命令行
2. 浏览器
3. 文件

- Schedule 

  调度器。决定调度的顺序。会将相应的调度保存到数据库paxos，然后borglet定时去数据库拉取数据。



#### kebernates

![image-20230117001051135](https://2290653824-github-io.oss-cn-hangzhou.aliyuncs.com/undefinedimage-20230117001051135.png)



- api server

所有服务访问的入口

- scheduel

负责接收任务，选择合适的节点进行分配任务

- 控制器ControllerManager

维护副本期望的数目，一个node可以设置一个期望的副本数目。

副本数量最好为>=3的基数个

- etcd 

存储k8s所有重要信息（持久化）

一个可信耐的分布式键值存储服务，它能为整个分布式集群存储一些关键数据，协助分布式集群的正常运转。

分为两种版本：memery和database

注意：kubuernates v1.11后etcd ，memery已经被弃用

etcd架构图：

![image-20230117001912609](https://2290653824-github-io.oss-cn-hangzhou.aliyuncs.com/undefinedimage-20230117001912609.png)

类比mysql，预写日志。



- kubelet

直接跟容器引擎交互实现容器的生命周期管理



- kubeproxy

负责写入规则至IPTAVLES、IPVS实现服务的映射

#### 其他重要的组件

- coreDNS（重要）

可以为集群中的SVC创建一个域名的对应关系解析

- dashboard

给k8s提供b/s结构访问体系

- ingress controller

官方只能实现4层代理，ingress可以实现7层代理

- fedetation：提供一个可以夸集群中心多k8s统一管理的功能
- prometheus

提供一个k8s集群的监控能力

- ELK

提供k8s日志统一接入平台





### 关键字







## 基础概念

### pod概念

管理的最小单位

![image-20230117003951692](https://2290653824-github-io.oss-cn-hangzhou.aliyuncs.com/undefinedimage-20230117003951692.png)

概念：一个pod中，可能存在多个容器。启动一个pod，必须先要启动一个pause容器，然后再启动其他的容器A、B。启动后AB网络共享、存储卷共享，即AB两者采用映射的方式都使用的是pause的网络和存储。

- 自主式 Pod

不会被管理器管理，死亡后不会复活





- 控制器管理的Pod







### 通讯模式

pod与pod之间的通讯



## kubernates

### 安装



### 自行构建集群



## 资源清单

### 语法

### 编写资源清单

### pod生命周期（重难点）



## pod 控制器（灵魂）



掌握各种控制器特点和使用方式



## 服务发现

将内部私有服务暴露给客户端

掌握syc原理以及构建方式



## 存储

服务分类

- 有状态服务

DBMS

- 无状态服务

LVS APACHE



多种存储类型的特点，并且在不同环境中选择不同的存储方案



## 调度器

可以将pod节点进行组装



## 安全机制

集群的认证、鉴权、访问控制、原理即流程



## HELM

类似yum管理器

掌握HELM原理，自定义模板，可以实现部署插件



## 运维

kubernates源码修改



kubernamtes高可用构建


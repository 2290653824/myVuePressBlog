---
title: 持续集成、持续交付、持续部署
date: 2023-01-24 10:35:05
permalink: /pages/a74b56/
categories:
  - 其他
  - 开发工具
tags:
  - 
author: 
  name: xugaoyi
  link: https://github.com/xugaoyi
---



## CI 持续集成

Continuous Integration

概念：频繁地（一天多次）将本地代码提交合并集成到主分支

优点：

- **快速发现错误。**每完成一点更新，就集成到主干，可以快速发现错误，定位错误也比较容易。
- **防止分支大幅偏离主干。**如果不是经常集成，主干又在不断更新，会导致以后集成的难度变大，甚至难以集成。

这样可以让产品进行快速的迭代，同时保持高质量。

在CI的过程中，开发人员将代码提交到主干过前，通过CI工具自动地对代码进行自动化2测试，只要一个测试不通过，就不能进行集成。通过此方法可以快速反馈给开发人员发现相关bug并进行改正。



采用持续集成时，开发人员可以使用诸如 Git 之类的版本控制系统，将更新频繁提交到共享存储库中。在每次提交前，开发人员可以选择在集成前对其代码执行本地单元测试，作为额外的验证层。持续集成服务在新代码更改上自动构建和运行单元测试，以立即发现任何错误。

*持续集成是指软件发布流程的构建和单元测试阶段。提交的每一个修订都会触发自动化的构建和测试操作。*



## CD持续交付

**持续交付（Continuous delivery）指的是，频繁地将软件的新版本，交付给质量团队或者用户，以供评审。**如果评审通过，代码就进入生产阶段。

持续交付可以看作持续集成的下一步。它强调的是，不管怎么更新，软件是随时随地可以交付的。



## 持续部署

**持续部署（continuous deployment）是持续交付的下一步，指的是代码通过评审以后，自动部署到生产环境。**

持续部署的目标是，代码在任何时刻都是可部署的，可以进入生产阶段。

持续部署的前提是能自动化完成测试、构建、部署等步骤。它与持续交付的区别，可以参考下图。

![image-20230124104500093](https://2290653824-github-io.oss-cn-hangzhou.aliyuncs.com/undefinedimage-20230124104500093.png)



## 流程简介

1. 提交commit

开发者向代码仓库提交代码

2. 测试（第一轮）

代码仓库配置钩子函数hook，一旦对代码仓库提交代码或者合并主干操作，就会执行钩子函数，进行自动化测试

测试的种类：

- 单元测试：针对函数或者模块的测试
- 集成测试：针对整体产品的某个功能的测试，又称为功能测试
- 端对端测试：从用户界面直达数据库的全链路测试

第一轮测试至少要进行单元测试



3. 构建build

此时第一次的测试已经进行完毕，代码已经合并到了仓库的主干。

交付后，就先进行构建（build），再进入第二轮测试。所谓构建，指的是将源码转换为可以运行的实际代码，比如安装依赖，配置各种资源（样式表、JS脚本、图片）等等。

常见的构件工具：Jenkins、Travis、Codeship、Strider

4. 测试（第二轮）

构建完成，就要进行第二轮测试。如果第一轮已经涵盖了所有测试内容，第二轮可以省略，当然，这时构建步骤也要移到第一轮测试前面。

第二轮是全面测试，单元测试和集成测试都会跑，有条件的话，也要做端对端测试。所有测试以自动化为主，少数无法自动化的测试用例，就要人工跑。

需要强调的是，新版本的每一个更新点都必须测试到。如果测试的覆盖率不高，进入后面的部署阶段后，很可能会出现严重的问题。



5. 部署

通过了第二轮测试，当前代码就是一个可以直接部署的版本（artifact）。将这个版本的所有文件打包（ `tar filename.tar *` ）存档，发到生产服务器。

生产服务器将打包文件，解包成本地的一个目录，再将运行路径的符号链接（symlink）指向这个目录，然后重新启动应用。这方面的部署工具有[Ansible](https://www.ansible.com/)，[Chef](https://www.chef.io/chef/)，[Puppet](https://puppetlabs.com/)等。



6. 回滚

一旦当前版本发生问题，就要回滚到上一个版本的构建结果。最简单的做法就是修改一下符号链接，指向上一个版本的目录。



## 如何使用

![image-20230407192226754](https://2290653824-github-io.oss-cn-hangzhou.aliyuncs.com/undefinedimage-20230407192226754.png)

jenkins

官网下载：

如果本地下载了java，可以直接下载java的war包

运行war包

复制密码

访问localhost:8080

下载推荐插件

创建管理用户



我们启动的这个程序可以看作git过程中的服务器



构建触发器

![image-20230407192818981](https://2290653824-github-io.oss-cn-hangzhou.aliyuncs.com/undefinedimage-20230407192818981.png)



通过shell进行构建

![image-20230407192858383](https://2290653824-github-io.oss-cn-hangzhou.aliyuncs.com/undefinedimage-20230407192858383.png)



原理：

1. 本地提交到远程仓库入github，github通过hock函数调用一个公网ip，公网中的jkens将代码拉取，并执行shell中的内容。



2. 本地提交到远程仓库入github，死亡定时检查github是否更新，如果检查到更新，则拉取代码，并执行shell中的内容。





travis - github

 [https://travis-ci-org](https://travis-ci-org)

该网站可以和github同步数据。同步过后，需要在github对应的项目的路径下，创建名为`.travis.yml`的执行脚本文件。



以上都是持续集成的流程



下面是持续交付

doucloud

 



mvn test是什么


![image-20230722211009215](https://2290653824-github-io.oss-cn-hangzhou.aliyuncs.com/image-20230722211009215.png)

前后分离、架构设计、高并发



难点：

单机--集群--阿里弹性云的部署

1. 一个红包发送给大家争抢

后端设计一个单机的抢红包

张三发送一个10元的红包，分成10份

> 用什么数据结构本次的发红包记录
>
> 1.1 发红包。100元，分10个红包发送，用什么数据结构
>
> 1.2 分红包。要求大家分的金额都差不多。即金额拆分范围（1个人99远，其他10远分1元，这肯定是不行的）【即拆分红包算法是什么】
>
> 1.3 抢红包。如何在高并发下抢红包。
>
> 要求：数据一致性+高并发+不能加锁(效率) 
>
> 1.4 记录本次红包活动的数据争抢情况。
>
> - 每个人分别抢到了多少，记录本次短期的。
>
> - 长期的统计并记录年度的红包总结（一年收发了多少红包）
>
> - 发送的红包，没人抢夺，没有任何一个红包被抢到，24小时候必须回退给红包发送者？如何回退？（一个人都没有抢，全部回退；部分人抢了红包，还有剩余，剩下的进行回退）
>
>   记录分为：短期记录+长期记录+没有抢到的红包进行回退

以上是单机最小的一个微服务。如果并发量持续加到，应该怎么办。

1w->10w 

![image-20230722212402322](https://2290653824-github-io.oss-cn-hangzhou.aliyuncs.com/image-20230722212402322.png)



集群：

![image-20230722212439621](https://2290653824-github-io.oss-cn-hangzhou.aliyuncs.com/image-20230722212439621.png)



集群后可能会有的问题：

> 被薅羊毛了，发现后台有人盗刷，如何配置白名单和ip重点限制。gateway网管+ 隔离策略
>
> 削峰限流+服务熔断+服务降级+服务流控，分割+限流+软件负载



## 单机

前端界面

红包后台：配置界面中心

![image-20230722214019956](https://2290653824-github-io.oss-cn-hangzhou.aliyuncs.com/image-20230722214019956.png)

![image-20230722214041126](https://2290653824-github-io.oss-cn-hangzhou.aliyuncs.com/image-20230722214041126.png)

业务介绍TODO

需求分析：

1. 各种节假日，发红包+抢红包，100%高并发业务要求，不能用mysql来做
2. 一个总的大红包，有可能被拆分成多个小红包，总金额=分金额1+分金额2+……+分金额N
3. 若每个人只能抢一次红包(当然一个人抢对也可以，现在我们规定只能抢一个)，你需要记录，比如100远，分拆分成10个红包发出去。总计有10个红包，抢一个少一个，总数显示(10/6)直到完，需要记录哪些人抢到了红包，重复抢

![image-20230722214711711](https://2290653824-github-io.oss-cn-hangzhou.aliyuncs.com/image-20230722214711711.png)



https://pan.baidu.com/s/1KyYTuMNwMRB8NkOAHBPYRA?fid=638073176941023 
42:25
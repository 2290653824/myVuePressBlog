---
title: ICMP
date: 2023-04-03 23:25:36
permalink: /pages/da7840/
categories:
  - 计算机基础
  - 计算机网络
tags:
  - 
author: 
  name: xugaoyi
  link: https://github.com/xugaoyi
---


## ICMP

Internet Control Message Protocol 网络控制报文协议

关键字：控制

在网络层当中，一条数据包发送出去过后，我怎么知道这个数据是否发送成功还是发送失败？发送失败错误原因是什么呢？就像我们前端调用后端接口，前端调用后总有个返回信息说明请求成功或者错误原因吧。







## 功能

确认IP包是否成功发送到目的地址、报告发送过程中IP包被抛弃的原因和改善网络的设置等。

> 在ip通信过程中，如果某个ip包因为某种原因没有成功到达目的地，那么这个失败的原因就由ICMP来负责通知给发送方。



![image-20230403233740085](https://2290653824-github-io.oss-cn-hangzhou.aliyuncs.com/undefinedimage-20230403233740085.png)

解析：

如上图例子，主机 `A` 向主机 `B` 发送了数据包，由于某种原因，途中的路由器 `2` 未能发现主机 `B` 的存在，这时，路由器 `2` 就会向主机 `A` 发送一个 `ICMP` 目标不可达数据包，说明发往主机 `B` 的包未能成功。

ICMP 的这种通知消息会使用 `IP` 进行发送 。

因此，从路由器 `2` 返回的 ICMP 包会按照往常的路由控制先经过路由器 `1` 再转发给主机 `A` 。收到该 ICMP 包的主机 `A` 则分解 ICMP 的首部和数据域以后得知具体发生问题的原因。





## ICMP 类型

- 一类是用于诊断的查询消息，也就是「**查询报文类型**」
- 另一类是通知出错原因的错误消息，也就是「**差错报文类型**」

![image-20230403233942152](https://2290653824-github-io.oss-cn-hangzhou.aliyuncs.com/undefinedimage-20230403233942152.png)
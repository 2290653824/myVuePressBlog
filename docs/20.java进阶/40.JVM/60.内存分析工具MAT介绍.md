1、MAT是什么？

  MAT(Memory Analyzer Tool)，一个基于Eclipse的内存分析工具，是一个快速、功能丰富的JAVA heap分析工具，它可以帮助我们查找内存泄漏和减少内存消耗。使用内存分析工具从众多的对象中进行分析，快速的计算出在内存中对象的占用大小，看看是谁 阻止了垃圾收集器的回收工作，并可以通过报表直观的查看到可能造成这种结果的对象。



下载

有两种方式

1. 在Eclipse上安装对应的插件
2. 直接下载独立版本的MAT

本文才用方式二(原因是Eclipse已经很少用了，为了MAT去下载一个Eclipse大应用很麻烦)

[MAT下载](https://www.eclipse.org/mat/downloads.php)

下载注意事项：

![image-20230616200352062](../../80.%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/20.%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/https%253A%252F%252F2290653824-github-io.oss-cn-hangzhou.aliyuncs.com%252Fimage-20230616200352062.png)

注意MAT的版本对应的jdk版本，最新的MAT对应的是jdk17。我这里需要下载对应jdk8的版本。



使用场景

场景一：内存溢出，JVM堆区或方法区放不下存活及待申请的对象。如：高峰期系统出现 OOM（Out of Memory）异常，需定位内存瓶颈点来指导优化。

场景二：内存泄漏，不会再使用的对象无法被垃圾回收器回收。如：系统运行一段时间后出现 Full GC，甚至周期性 OOM 后需人工重启解决。

场景三：内存占用高。如：系统频繁 GC ，需定位影响服务实时性、稳定性、吞吐能力的原因。



怎么得到一个dump文件？

获取堆快照 dump 文件（堆转储需要先执行 Full GC，线上服务使用时请注意影响），一般用三种方式：

- 使用 JDK 提供的 jmap 工具，命令是 jmap -dump:format=b,file=文件名 进程号。当进程接近僵死时，可以添加 -F 参数强制转储：jmap -F -dump:format=b,file=文件名 进程号。

1. 首先自己先启动一个java项目
2. 使用jps命令查看java进程号
3. 使用命令 `jmap -dump:format=b,file=文件名 进程号 `将dump文件打印到指定位置







- 本地运行的 Java 进程，直接在 MAT 使用 File → accquire heap dump 功能获取。
- 启动 Java 进程时配置JVM参数：-XX:-HeapDumpOnOutOfMemoryError，当发生 OOM 时无需人工干预会自动生成 dump文件。指定目录用 -XX:HeapDumpPath=文件路径 来设置。







参考：

[MAT](https://juejin.cn/post/6911624328472133646)